# Веб-приложение для бронирования отелей. 

## Описание
Приложение предоставляет REST API с функционалом:

1. Пользователи могут создать учетную запись, войти и выйти из системы.
2. Можно добавлять в систему новые отели, редактировать или удалять существующие. У отеля есть название, описание, адрес, количество номеров.
3. В каждом отеле есть номера. Их тоже можно добавлять, изменять и удалять. У номера есть цена, количество мест, описание.
4. Пользователи могут искать отели в каком-то городе на определенные даты. Видят какие номера свободны.
5. Можно бронировать номера на выбранные даты. Пользователю приходит письмо с подтверждением.
6. Пользователь может посмотреть список своих бронирований, отменить бронь.
7. В админ-панели администратор может управлять отелями, номерами, пользователями и их бронями.
8. Есть специальные инструменты для мониторинга работы приложения и сбора статистики.

## Технологии
* FastAPI - высокопроизводительный фреймворк для построения API
* ORM SQLAlchemy - для работы с БД
* PostgreSQL - основная реляционная БД
* Alembic - миграции БД
* REDIS - кэш и брокер задач
* Celery - асинхронная обработка задач
* Docker - контейнеризация приложения
* Prometheus - сбор метрик
* Grafana - визуализация метрик
* Sentry - мониторинг ошибок

## Запуск приложения
Для запуска FastAPI используется веб-сервер uvicorn. Команда для запуска выглядит так:  
```
uvicorn app.main:app --reload
```  
Ее необходимо запускать в командной строке, обязательно находясь в корневой директории проекта.

### Celery & Flower
Для запуска Celery используется команда  
```
celery --app=app.tasks.celery:celery worker -l INFO -P solo
```
Обратите внимание, что `-P solo` используется только на Windows, так как у Celery есть проблемы с работой на Windows.  
Для запуска Flower используется команда  
```
celery --app=app.tasks.celery:celery flower
``` 

### Dockerfile
Для запуска веб-сервера (FastAPI) внутри контейнера необходимо раскомментировать код внутри Dockerfile и иметь уже запущенный экземпляр PostgreSQL на компьютере.
Код для запуска Dockerfile:  
```
docker build .
```  
Команда также запускается из корневой директории, в которой лежит файл Dockerfile.

### Docker compose
Для запуска всех сервисов (БД, Redis, веб-сервер (FastAPI), Celery, Flower, Grafana, Prometheus) необходимо использовать файл docker-compose.yml и команды
```
docker compose build
docker compose up
```
Причем `build` команду нужно запускать, только если вы меняли что-то внутри Dockerfile, то есть меняли логику составления образа.

